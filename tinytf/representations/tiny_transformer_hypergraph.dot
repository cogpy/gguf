digraph TinyTransformer {
  rankdir=TB;
  node [shape=box];

  "input_tokens" [label="input_tokens\ntensor\nshape: (None, 5)", fillcolor="lightblue", style=filled];
  "embedding_weights" [label="embedding_weights\nparameter\nshape: (10, 5)", fillcolor="lightgreen", style=filled];
  "embeddings" [label="embeddings\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "position_ids" [label="position_ids\ntensor\nshape: (None, 5)", fillcolor="lightblue", style=filled];
  "attn_query_weights" [label="attn_query_weights\nparameter\nshape: (5, 5)", fillcolor="lightgreen", style=filled];
  "attn_query" [label="attn_query\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "attn_key_weights" [label="attn_key_weights\nparameter\nshape: (5, 5)", fillcolor="lightgreen", style=filled];
  "attn_key" [label="attn_key\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "attn_value_weights" [label="attn_value_weights\nparameter\nshape: (5, 5)", fillcolor="lightgreen", style=filled];
  "attn_value" [label="attn_value\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "attn_scores" [label="attn_scores\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "attn_weights" [label="attn_weights\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "attn_output_pre" [label="attn_output_pre\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "attn_output_weights" [label="attn_output_weights\nparameter\nshape: (5, 5)", fillcolor="lightgreen", style=filled];
  "attn_output" [label="attn_output\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "attn_residual" [label="attn_residual\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "ln1_weight" [label="ln1_weight\nparameter\nshape: (5,)", fillcolor="lightgreen", style=filled];
  "ln1_bias" [label="ln1_bias\nparameter\nshape: (5,)", fillcolor="lightgreen", style=filled];
  "ln1_output" [label="ln1_output\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "ffn_w1" [label="ffn_w1\nparameter\nshape: (5, 5)", fillcolor="lightgreen", style=filled];
  "ffn_hidden" [label="ffn_hidden\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "ffn_w2" [label="ffn_w2\nparameter\nshape: (5, 5)", fillcolor="lightgreen", style=filled];
  "ffn_output" [label="ffn_output\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "ffn_residual" [label="ffn_residual\ntensor\nshape: (None, 5, 5)", fillcolor="lightblue", style=filled];
  "output_weights" [label="output_weights\nparameter\nshape: (5, 10)", fillcolor="lightgreen", style=filled];
  "logits" [label="logits\ntensor\nshape: (None, 5, 10)", fillcolor="lightblue", style=filled];

  "embed_tokens" [label="embedding_lookup", shape=diamond, fillcolor="orange", style=filled];
  "input_tokens" -> "embed_tokens";
  "embedding_weights" -> "embed_tokens";
  "embed_tokens" -> "embeddings";
  "project_query" [label="linear", shape=diamond, fillcolor="orange", style=filled];
  "embeddings" -> "project_query";
  "attn_query_weights" -> "project_query";
  "project_query" -> "attn_query";
  "project_key" [label="linear", shape=diamond, fillcolor="orange", style=filled];
  "embeddings" -> "project_key";
  "attn_key_weights" -> "project_key";
  "project_key" -> "attn_key";
  "project_value" [label="linear", shape=diamond, fillcolor="orange", style=filled];
  "embeddings" -> "project_value";
  "attn_value_weights" -> "project_value";
  "project_value" -> "attn_value";
  "compute_attention_scores" [label="matmul_scaled", shape=diamond, fillcolor="orange", style=filled];
  "attn_query" -> "compute_attention_scores";
  "attn_key" -> "compute_attention_scores";
  "compute_attention_scores" -> "attn_scores";
  "apply_softmax" [label="softmax", shape=diamond, fillcolor="orange", style=filled];
  "attn_scores" -> "apply_softmax";
  "apply_softmax" -> "attn_weights";
  "apply_attention" [label="matmul", shape=diamond, fillcolor="orange", style=filled];
  "attn_weights" -> "apply_attention";
  "attn_value" -> "apply_attention";
  "apply_attention" -> "attn_output_pre";
  "project_output" [label="linear", shape=diamond, fillcolor="orange", style=filled];
  "attn_output_pre" -> "project_output";
  "attn_output_weights" -> "project_output";
  "project_output" -> "attn_output";
  "attention_residual" [label="add", shape=diamond, fillcolor="orange", style=filled];
  "embeddings" -> "attention_residual";
  "attn_output" -> "attention_residual";
  "attention_residual" -> "attn_residual";
  "layer_norm_1" [label="layer_norm", shape=diamond, fillcolor="orange", style=filled];
  "attn_residual" -> "layer_norm_1";
  "ln1_weight" -> "layer_norm_1";
  "ln1_bias" -> "layer_norm_1";
  "layer_norm_1" -> "ln1_output";
  "ffn_layer1" [label="linear_gelu", shape=diamond, fillcolor="orange", style=filled];
  "ln1_output" -> "ffn_layer1";
  "ffn_w1" -> "ffn_layer1";
  "ffn_layer1" -> "ffn_hidden";
  "ffn_layer2" [label="linear", shape=diamond, fillcolor="orange", style=filled];
  "ffn_hidden" -> "ffn_layer2";
  "ffn_w2" -> "ffn_layer2";
  "ffn_layer2" -> "ffn_output";
  "ffn_residual_add" [label="add", shape=diamond, fillcolor="orange", style=filled];
  "ln1_output" -> "ffn_residual_add";
  "ffn_output" -> "ffn_residual_add";
  "ffn_residual_add" -> "ffn_residual";
  "output_projection" [label="linear", shape=diamond, fillcolor="orange", style=filled];
  "ffn_residual" -> "output_projection";
  "output_weights" -> "output_projection";
  "output_projection" -> "logits";
}